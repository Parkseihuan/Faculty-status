<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>êµì› í˜„í™©í‘œ</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/table-styles.css">
  <style>
    /* Column Widths - Kept inline for specificity */
    col:nth-child(1) { width: 40px !important; } /* Dept Group */
    col:nth-child(2) { width: 100px !important; } /* Dept Name */
    
    /* Faculty Columns */
    col:nth-child(3), col:nth-child(4), col:nth-child(5),
    col:nth-child(6), col:nth-child(7) { width: 160px !important; }
    
    col:nth-child(8) { width: 50px !important; } /* Subtotal */
    
    /* Part-time Columns */
    col:nth-child(9), col:nth-child(10), col:nth-child(11),
    col:nth-child(12), col:nth-child(13), col:nth-child(14) { width: 160px !important; }
    
    col:nth-child(15) { width: 50px !important; } /* Subtotal */
    
    /* Other Columns */
    col:nth-child(16), col:nth-child(17), col:nth-child(18),
    col:nth-child(19), col:nth-child(20), col:nth-child(21),
    col:nth-child(22) { width: 160px !important; }
    
    col:nth-child(23) { width: 60px !important; } /* Grand Total */

    /* Sticky Column Widths matching col widths */
    table tbody tr td:first-child,
    table thead tr th:first-child {
      width: 40px !important;
      min-width: 40px !important;
      max-width: 40px !important;
    }

    table tbody tr td:nth-child(2),
    table thead tr th:nth-child(2) {
      width: 100px !important;
      min-width: 100px !important;
      max-width: 100px !important;
    }

    /* Colspan for sticky header */
    table tbody tr td[colspan="2"],
    table thead tr th[colspan="2"] {
      width: 140px !important; /* 40 + 100 */
      min-width: 140px !important;
      max-width: 140px !important;
    }
    
    /* Material Spinner */
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #1a73e8;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="controls">
      <div class="controls-left">
        <a href="admin.html" class="btn">ğŸ” ê´€ë¦¬ì</a>
      </div>
      <div class="controls-right">
        <button class="btn" onclick="loadData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        <button class="btn btn-primary" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„</button>
      </div>
    </div>
    
    <div id="content" class="table-container">
      <div class="loading">
        <div>
          <div class="spinner"></div>
          <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
      </div>
    </div>
    
    <div class="footnote">
      <div class="footnote-header" onclick="toggleFootnote()">
        <span>â„¹ï¸ ë²”ë¡€ ë° ì£¼ì˜ì‚¬í•­</span>
        <span class="arrow">â–¼</span>
      </div>
      <div class="footnote-content" id="footnoteContent">
        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
          <div>
            <strong>í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼</strong><br/>
            â€¢ <b>ì§„í•œ ê¸€ì”¨</b>: ì—°ë´‰ì œ ì „ì„êµì›<br/>
            â€¢ <span style="color: #1a73e8; font-weight: bold;">íŒŒë€ìƒ‰</span>: íœ´ì§<br/>
            â€¢ <span style="color: #1e8e3e; font-weight: bold;">ì´ˆë¡ìƒ‰</span>: ì—°êµ¬ë…„
          </div>
          <div>
            <strong>ë°°ê²½ìƒ‰ ì˜ë¯¸ (ì„ìš©/ì •ë…„)</strong><br/>
            â€¢ <span class="name-badge retirement-upcoming">ì—°ë‘ìƒ‰</span>: 12ê°œì›” ì´ë‚´ ì •ë…„ ë„ë˜<br/>
            â€¢ <span class="name-badge appointment-urgent">ë¶‰ì€ìƒ‰</span>: ë§Œë£Œ 3ê°œì›” ì „ (ê¸´ê¸‰)<br/>
            â€¢ <span class="name-badge appointment-warning">ì£¼í™©ìƒ‰</span>: ë§Œë£Œ 6ê°œì›” ì „ (ì£¼ì˜)<br/>
            â€¢ <span class="name-badge appointment-caution">ë…¸ë€ìƒ‰</span>: ë§Œë£Œ 9ê°œì›” ì „ (ê´€ì‹¬)
          </div>
        </div>
        <div style="margin-top: 10px; font-size: 11px; color: #5f6368;">
          * ì´ë¦„ ì˜† ìˆ«ì: ì¬ì„ìš©/ì •ë…„ê¹Œì§€ ë‚¨ì€ ê°œì›” ìˆ˜ (12ê°œì›” ì´í•˜ë§Œ í‘œì‹œ)<br/>
          * ê° êµì›ëª…ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
      </div>
    </div>
  </div>
  
  <!-- ëª¨ë‹¬ -->
  <div id="detailModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">êµì› ì •ë³´</h3>
        <span class="modal-close" onclick="closeModal()">&times;</span>
      </div>
      <div id="modalBody"></div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/config.js"></script>
  <script src="js/api.js"></script>
  <script>
    let globalData = null;
    
    // ì£¼ì˜ì‚¬í•­ í† ê¸€ í•¨ìˆ˜
    function toggleFootnote() {
      const content = document.getElementById('footnoteContent');
      const arrow = document.querySelector('.arrow');
      
      if (content.style.display === 'block') {
        content.style.display = 'none';
        arrow.style.transform = 'rotate(0deg)';
      } else {
        content.style.display = 'block';
        arrow.style.transform = 'rotate(180deg)';
      }
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    window.onload = function() {
      loadData();
    };

    // ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadData() {
      document.getElementById('content').innerHTML = `
        <div class="loading">
          <div>
            <div class="spinner"></div>
            <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
          </div>
        </div>
      `;

      try {
        const response = await api.getFacultyData();
        if (response.success) {
          handleSuccess(response.data);
        } else {
          handleError(response.error || 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        handleError('ì„œë²„ ì—°ê²° ì˜¤ë¥˜: ' + error.message);
      }
    }
    
    // ì„±ê³µ ì²˜ë¦¬
    function handleSuccess(data) {
      console.log('Received data:', data);
      globalData = data;
      renderTable();
    }
    
    // ì—ëŸ¬ ì²˜ë¦¬
    function handleError(error) {
      document.getElementById('content').innerHTML = 
        '<div class="error">âš ï¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤<br>' + error + '</div>';
    }
    
    // í•™ê³¼ëª… í¬ë§·íŒ… í•¨ìˆ˜
    function formatDeptName(deptName) {
      if (deptName === 'ë¬´ë„ìŠ¤í¬ì¸ ì‚°ì—…í•™ê³¼(ê³„ì•½í•™ê³¼)') {
        return 'ë¬´ë„ìŠ¤í¬ì¸ ì‚°ì—…í•™ê³¼<br/>(ê³„ì•½í•™ê³¼)';
      } else if (deptName === 'ë¯¸ìš©ê²½ì˜í•™ê³¼(ì•¼)') {
        return 'ë¯¸ìš©ê²½ì˜í•™ê³¼<br/>(ì•¼)';
      }
      return deptName;
    }
    
    // ì„ìš© ì¢…ë£Œì¼ê¹Œì§€ì˜ ê°œì›” ìˆ˜ ê³„ì‚°
    function getMonthsUntilEnd(endDate) {
      if (!endDate) return null;
      
      const today = new Date();
      const end = new Date(endDate);
      
      if (isNaN(end.getTime())) return null;
      
      const yearDiff = end.getFullYear() - today.getFullYear();
      const monthDiff = end.getMonth() - today.getMonth();
      const dayDiff = end.getDate() - today.getDate();
      
      let totalMonths = yearDiff * 12 + monthDiff;
      if (dayDiff < 0) totalMonths--;
      
      return Math.max(0, totalMonths);
    }
    
    // ì„ìš© ì¢…ë£Œì¼ ê¸°ë°˜ CSS í´ë˜ìŠ¤ ê²°ì •
    function getAppointmentClass(item) {
      // ëª…ì˜ˆêµìˆ˜ëŠ” ê¸°ë³¸ ìŠ¤íƒ€ì¼
      if (item.position === 'ëª…ì˜ˆêµìˆ˜') {
        return 'appointment-safe';
      }
      
      // ì •ë…„ ë„ë˜ ì˜ˆì •ì ì²´í¬ (12ê°œì›” ì´ë‚´)
      if (item.isRetirementGuaranteed && item.retirementDate) {
        const monthsToRetirement = getMonthsUntilEnd(item.retirementDate);
        if (monthsToRetirement !== null && monthsToRetirement <= 12) {
          return 'retirement-upcoming';
        }
        return 'appointment-safe';
      }
      
      // ì¼ë°˜ ì„ìš© ì¢…ë£Œì¼ ì²´í¬
      const endDate = item.reappointmentEnd || item.firstAppointmentEnd;
      const months = getMonthsUntilEnd(endDate);
      
      if (months === null || months > 12) return 'appointment-safe';
      if (months <= 3) return 'appointment-urgent';
      if (months <= 6) return 'appointment-warning';
      if (months <= 9) return 'appointment-caution';
      return 'appointment-notice';
    }
    
    // ì´ë¦„ ëª©ë¡ì„ ë²„íŠ¼ í˜•íƒœë¡œ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
    function formatNames(names) {
      if (!names || names.length === 0) return '';
      
      const allNames = [];
      
      names.forEach(item => {
        let nameStr = '';
        let classes = [];
        
        // ë¬¸ìì—´ì¸ ê²½ìš°
        if (typeof item === 'string') {
          const cleanedStr = item.trim();
          if (cleanedStr.includes(',')) {
            cleanedStr.split(',').forEach(n => {
              const trimmed = n.trim();
              if (trimmed) allNames.push({name: trimmed, classes: [], item: {name: trimmed}});
            });
            return;
          }
          
          const namePattern = /[ê°€-í£]{2,4}/g;
          const foundNames = cleanedStr.match(namePattern);
          
          if (foundNames && foundNames.length > 1) {
            foundNames.forEach(n => allNames.push({name: n, classes: [], item: {name: n}}));
            return;
          }
          
          if (cleanedStr) {
            allNames.push({name: cleanedStr, classes: [], item: {name: cleanedStr}});
          }
        }
        // ê°ì²´ì¸ ê²½ìš°
        else {
          nameStr = item.name;
          
          if (nameStr.includes(',')) {
            nameStr.split(',').forEach(n => {
              const trimmed = n.trim();
              if (trimmed) {
                let formattedName = trimmed;
                const nameClasses = [];
                
                if (item.status && nameStr.split(',').indexOf(n) === nameStr.split(',').length - 1) {
                  formattedName += `(${item.status})`;
                }
                
                if (item.isSalary) nameClasses.push('salary-bold');
                if (item.status === 'íœ´ì§') nameClasses.push('status-leave');
                else if (item.status === 'ì—°êµ¬') nameClasses.push('status-research');
                
                nameClasses.push(getAppointmentClass(item));
                
                let months = null;
                if (item.position !== 'ëª…ì˜ˆêµìˆ˜') {
                  if (item.isRetirementGuaranteed && item.retirementDate) {
                    months = getMonthsUntilEnd(item.retirementDate);
                  } else {
                    const endDate = item.reappointmentEnd || item.firstAppointmentEnd;
                    months = getMonthsUntilEnd(endDate);
                  }
                }
                
                allNames.push({name: formattedName, classes: nameClasses, item: {...item, serialType: item.serialType}, months: months});
              }
            });
            return;
          }
          
          if (item.isSalary) classes.push('salary-bold');
          
          if (item.status) {
            nameStr += `(${item.status})`;
            if (item.status === 'íœ´ì§') classes.push('status-leave');
            else if (item.status === 'ì—°êµ¬') classes.push('status-research');
          }
          
          classes.push(getAppointmentClass(item));
          
          let months = null;
          if (item.position !== 'ëª…ì˜ˆêµìˆ˜') {
            if (item.isRetirementGuaranteed && item.retirementDate) {
              const monthsToRetirement = getMonthsUntilEnd(item.retirementDate);
              if (monthsToRetirement !== null && monthsToRetirement <= 12) {
                months = monthsToRetirement;
              }
            } else {
              const endDate = item.reappointmentEnd || item.firstAppointmentEnd;
              months = getMonthsUntilEnd(endDate);
            }
          }
          
          allNames.push({name: nameStr, classes: classes, item: {...item, serialType: item.serialType}, months: months});
        }
      });
      
      const result = [];
      allNames.forEach((nameObj) => {
        const classStr = ['name-badge', ...nameObj.classes].join(' ');
        let appointmentInfo = '';
        
        if (nameObj.months !== null && nameObj.months <= 12) {
          appointmentInfo = `<span class="appointment-info">${nameObj.months}</span>`;
        }
        
        let nameText = nameObj.name;
        
        result.push(`<span class="${classStr}" onclick="showFacultyDetail('${encodeURIComponent(JSON.stringify(nameObj.item))}')">${nameText}${appointmentInfo}</span>`);
      });
      
      return result.join(' ');
    }
    
    // ë§Œë‚˜ì´ ê³„ì‚° í•¨ìˆ˜
    function calculateAge(birthDate) {
      if (!birthDate) return null;
      const today = new Date();
      const birth = new Date(birthDate);
      if (isNaN(birth.getTime())) return null;
      let age = today.getFullYear() - birth.getFullYear();
      const monthDiff = today.getMonth() - birth.getMonth();
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
        age--;
      }
      return age;
    }
    
    // êµì› ìƒì„¸ ì •ë³´ í‘œì‹œ í•¨ìˆ˜
    function showFacultyDetail(encodedData) {
      try {
        const data = JSON.parse(decodeURIComponent(encodedData));
        const modal = document.getElementById('detailModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        
        let cleanName = data.name;
        if (data.status) {
          cleanName = cleanName.replace(`(${data.status})`, '').trim();
        }
        
        modalTitle.textContent = `${cleanName} êµì› ì •ë³´`;
        
        let genderText = data.gender ? (data.gender === 'ë‚¨' ? '<span style="color: #1a73e8;">ë‚¨ì„±</span>' : '<span style="color: #d93025;">ì—¬ì„±</span>') : '<span style="color: #999;">(ì •ë³´ ì—†ìŒ)</span>';
        
        let birthDateText = data.birthDate || '<span style="color: #999;">(ì •ë³´ ì—†ìŒ)</span>';
        const age = calculateAge(data.birthDate);
        if (age !== null) birthDateText += ` (ë§Œ ${age}ì„¸)`;
        
        let listHtml = `<ul class="modal-list">`;
        listHtml += `<li><strong>ì„±ëª…</strong> ${cleanName}</li>`;
        listHtml += `<li><strong>ì„±ë³„</strong> ${genderText}</li>`;
        listHtml += `<li><strong>ìƒë…„ì›”ì¼</strong> ${birthDateText}</li>`;
        
        if (data.firstAppointmentStart) {
            listHtml += `<li><strong>ìµœì´ˆ ì„ìš©ì¼</strong> ${data.firstAppointmentStart}</li>`;
        }
        
        let endLabel = 'ì„ìš© ì¢…ë£Œì¼';
        let endValue = '';
        if (data.position === 'ëª…ì˜ˆêµìˆ˜') {
            endValue = 'í•´ë‹¹ ì—†ìŒ';
        } else if (data.isRetirementGuaranteed && data.retirementDate) {
            endLabel = 'ì •ë…„ ì¼ì';
            endValue = data.retirementDate;
            const m = getMonthsUntilEnd(data.retirementDate);
            if (m !== null) endValue += ` (${m}ê°œì›” ë‚¨ìŒ)`;
        } else {
            const end = data.reappointmentEnd || data.firstAppointmentEnd;
            if (end) {
                endValue = end;
                const m = getMonthsUntilEnd(end);
                if (m !== null) endValue += ` (${m}ê°œì›” ë‚¨ìŒ)`;
            } else {
                endValue = '(ì •ë³´ ì—†ìŒ)';
            }
        }
        listHtml += `<li><strong>${endLabel}</strong> ${endValue}</li>`;
        
        if (data.college || data.dept) {
            listHtml += `<li><strong>ì†Œì†</strong> ${data.college || ''} ${data.dept || ''}</li>`;
        }
        
        if (data.position) {
            listHtml += `<li><strong>ì§ê¸‰</strong> ${data.position}</li>`;
        }
        
        if (data.status) {
            listHtml += `<li><strong>ìƒíƒœ</strong> ${data.status}</li>`;
        }
        
        if (data.serialType === 'ì „ì„êµì›') {
            listHtml += `<li><strong>ê¸‰ì—¬ì²´ê³„</strong> ${data.isSalary ? 'ì—°ë´‰ì œ' : 'í˜¸ë´‰ì œ'}</li>`;
        }
        
        listHtml += `</ul>`;
        
        modalBody.innerHTML = listHtml;
        modal.style.display = 'block';
      } catch (error) {
        console.error('Error showing faculty detail:', error);
      }
    }
    
    function closeModal() {
      document.getElementById('detailModal').style.display = 'none';
    }
    
    window.onclick = function(event) {
      const modal = document.getElementById('detailModal');
      if (event.target == modal) {
        modal.style.display = 'none';
      }
    }
    
    // í…Œì´ë¸” ë Œë”ë§
    function renderTable() {
      if (!globalData) return;
      
      const { facultyData, deptStructure, fullTimePositions, partTimePositions, otherPositions } = globalData;
      const currentDate = new Date().toLocaleDateString('ko-KR');
      
      let html = `
        <table>
            <colgroup>
              <col style="width: 40px !important;">
              <col style="width: 100px !important;">
              <col style="width: 160px !important;">
              <col style="width: 160px !important;">
              <col style="width: 160px !important;">
              <col style="width: 160px !important;">
              <col style="width: 160px !important;">
              <col style="width: 50px !important;">
              <col style="width: 160px !important;">
              <col style="width: 160px !important;">
              <col style="width: 160px !important;">
              <col style="width: 160px !important;">
              <col style="width: 160px !important;">
              <col style="width: 160px !important;">
              <col style="width: 50px !important;">
              <col style="width: 160px !important;">
              <col style="width: 160px !important;">
              <col style="width: 160px !important;">
              <col style="width: 160px !important;">
              <col style="width: 160px !important;">
              <col style="width: 160px !important;">
              <col style="width: 160px !important;">
              <col style="width: 60px !important;">
            </colgroup>
            <thead>
              <tr>
                <th colspan="${3 + fullTimePositions.length + partTimePositions.length + otherPositions.length + 3}">
                  êµì›í˜„í™© (${currentDate})
                </th>
              </tr>
              <tr>
                <th rowspan="2" colspan="2">êµ¬ë¶„</th>
                <th colspan="${fullTimePositions.length + 1}">ì „ì„êµì›</th>
                <th colspan="${partTimePositions.length + 1}">ë¹„ì „ì„êµì›</th>
                <th colspan="${otherPositions.length}">ê¸°íƒ€</th>
                <th rowspan="2">í•©ê³„</th>
              </tr>
              <tr>
      `;
      
      fullTimePositions.forEach(pos => {
        if (pos.includes('ë¹„ì •ë…„íŠ¸ë™')) {
          const parts = pos.split('(');
          html += `<th>${parts[0]}<br/><span style="font-size: 10px; color: #5f6368;">(${parts[1]}</span></th>`;
        } else {
          html += `<th>${pos}</th>`;
        }
      });
      html += '<th class="subtotal-full">ì†Œê³„</th>';
      
      partTimePositions.forEach(pos => html += `<th>${pos}</th>`);
      html += '<th class="subtotal-part">ì†Œê³„</th>';
      
      otherPositions.forEach(pos => html += `<th>${pos}</th>`);
      
      html += '</tr></thead><tbody>';
      
      const calculateTotal = (data, positions) => {
        let total = 0;
        positions.forEach(pos => {
          if (data[pos]) total += data[pos].length;
        });
        return total;
      };
      
      const calculateColumnTotal = (pos) => {
        let total = 0;
        Object.values(facultyData).forEach(deptGroup => {
           Object.values(deptGroup).forEach(dept => {
               if (dept[pos]) total += dept[pos].length;
           });
        });
        return total;
      };

      deptStructure.forEach(dept => {
        if (dept.name === 'ëŒ€í•™ì›' || (dept.subDepts && dept.subDepts.length > 0)) {
           let activeDepts = dept.subDepts;
           if (dept.name !== 'ëŒ€í•™ì›') {
             activeDepts = dept.subDepts.filter(subDept => {
               const deptData = facultyData[dept.name] && facultyData[dept.name][subDept];
               return deptData && Object.values(deptData).some(arr => arr && arr.length > 0);
             });
           }
           if (activeDepts.length === 0 && dept.name === 'ëŒ€í•™ì›') activeDepts = dept.subDepts;
           else if (activeDepts.length === 0) return;

           activeDepts.forEach((subDept, subIdx) => {
             const deptData = facultyData[dept.name] && facultyData[dept.name][subDept] ? facultyData[dept.name][subDept] : {};
             const fullTimeTotal = calculateTotal(deptData, fullTimePositions);
             const partTimeTotal = calculateTotal(deptData, partTimePositions);
             const otherTotal = calculateTotal(deptData, otherPositions);
             const grandTotal = fullTimeTotal + partTimeTotal + otherTotal;

             html += '<tr>';
             if (subIdx === 0) {
                const verticalDepts = ['ëŒ€í•™ì›', 'ë¬´ë„ëŒ€í•™', 'ì²´ìœ¡ê³¼í•™ëŒ€í•™', 'ë¬¸í™”ì˜ˆìˆ ëŒ€í•™', 'ì¸ë¬¸ì‚¬íšŒìœµí•©ëŒ€í•™', 'AIë°”ì´ì˜¤ìœµí•©ëŒ€í•™'];
                const isVertical = verticalDepts.includes(dept.name);
                html += `<td rowspan="${activeDepts.length}" class="dept-header ${isVertical ? 'dept-vertical' : ''}">${dept.name}</td>`;
             }
             html += `<td class="dept-name">${formatDeptName(subDept)}</td>`;
             
             fullTimePositions.forEach(pos => html += `<td class="names-cell">${formatNames(deptData[pos])}</td>`);
             html += `<td class="subtotal-full">${fullTimeTotal}</td>`;
             
             partTimePositions.forEach(pos => html += `<td class="names-cell">${formatNames(deptData[pos])}</td>`);
             html += `<td class="subtotal-part">${partTimeTotal}</td>`;
             
             otherPositions.forEach(pos => html += `<td class="names-cell">${formatNames(deptData[pos])}</td>`);
             html += `<td class="grand-total">${grandTotal}</td>`;
             html += '</tr>';
           });
        } else {
           const deptData = facultyData[dept.name] || {};
           const fullTimeTotal = calculateTotal(deptData, fullTimePositions);
           const partTimeTotal = calculateTotal(deptData, partTimePositions);
           const otherTotal = calculateTotal(deptData, otherPositions);
           const grandTotal = fullTimeTotal + partTimeTotal + otherTotal;
           
           html += '<tr>';
           html += `<td colspan="2" class="dept-header">${dept.name}</td>`;
           fullTimePositions.forEach(pos => html += `<td class="names-cell">${formatNames(deptData[pos])}</td>`);
           html += `<td class="subtotal-full">${fullTimeTotal}</td>`;
           partTimePositions.forEach(pos => html += `<td class="names-cell">${formatNames(deptData[pos])}</td>`);
           html += `<td class="subtotal-part">${partTimeTotal}</td>`;
           otherPositions.forEach(pos => html += `<td class="names-cell">${formatNames(deptData[pos])}</td>`);
           html += `<td class="grand-total">${grandTotal}</td>`;
           html += '</tr>';
        }
      });
      
      const etcData = facultyData['ê¸°íƒ€'] || {};
      const etcFullTimeTotal = calculateTotal(etcData, fullTimePositions);
      const etcPartTimeTotal = calculateTotal(etcData, partTimePositions);
      const etcOtherTotal = calculateTotal(etcData, otherPositions);
      const etcGrandTotal = etcFullTimeTotal + etcPartTimeTotal + etcOtherTotal;
      
      html += '<tr><td colspan="2" class="dept-header">ê¸°íƒ€</td>';
      fullTimePositions.forEach(pos => html += `<td class="names-cell">${formatNames(etcData[pos])}</td>`);
      html += `<td class="subtotal-full">${etcFullTimeTotal}</td>`;
      partTimePositions.forEach(pos => html += `<td class="names-cell">${formatNames(etcData[pos])}</td>`);
      html += `<td class="subtotal-part">${etcPartTimeTotal}</td>`;
      otherPositions.forEach(pos => html += `<td class="names-cell">${formatNames(etcData[pos])}</td>`);
      html += `<td class="grand-total">${etcGrandTotal}</td></tr>`;
      
      html += '<tr class="total-row"><td colspan="2">í•©ê³„</td>';
      
      let totalFullTime = 0;
      fullTimePositions.forEach(pos => {
        const total = calculateColumnTotal(pos);
        totalFullTime += total;
        html += `<td>${total}</td>`;
      });
      html += `<td>${totalFullTime}</td>`;
      
      let totalPartTime = 0;
      partTimePositions.forEach(pos => {
        const total = calculateColumnTotal(pos);
        totalPartTime += total;
        html += `<td>${total}</td>`;
      });
      html += `<td>${totalPartTime}</td>`;
      
      let totalOther = 0;
      otherPositions.forEach(pos => {
        const total = calculateColumnTotal(pos);
        totalOther += total;
        html += `<td>${total}</td>`;
      });
      
      const grandTotalAll = totalFullTime + totalPartTime + totalOther;
      html += `<td>${grandTotalAll}</td></tr>`;
      
      html += '</tbody></table>';
      
      document.getElementById('content').innerHTML = html;
    }
  </script>
</body>
</html>
